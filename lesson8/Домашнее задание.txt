1. Найти 10 покупателей, у которых самый многообещающий тренд по сумме транзакции. Многообещающий тренд определяем, как наибольшее значение наклона прогноза следующей суммы транзакции покупателя на основе линейной регрессии его покупок.
Формулу линейной регресии определяем на основе скользящего среднего сумм транзакций покупателя за первое полугодие 2025 года с шириной окна 3, включая текущую транзакцию. У покупателя за отчетный период должно быть минимум 6 транзакций (в среднем одна транзакция за полгода).
Подсказка: По каждому покупателю считаем скользящее среднее трех последних транзакций, включая текущую. Скользящие средние, у которых нет трех транзакций исключаем, так как у них нет достаточного числа событий.
Далее по каждому покупателю вычисляем коэффициент k модели линейной регресии на основе его транзакций. В итоге оставляем 10 покупателей с наибольшим коэффициентом k.
Запрос должен вернуть две колонки: идентификатор покупателя, значение коэффициента k.
Ключевые слова и фразы: ROW_NUMBER, AVG, LIMIT, PARTITION BY, PRECEDING, CURRENT ROW, REGR_SLOPE (PG), simpleLinearRegression (CH)

2. Вычислить среднюю, минимальную и максимальную дискретность транзакций на покупателя в разрезе категорий "Кофе" и "Сахар" за период с марта 2025 по июль 2025 включительно.
Дискретность считаем изначально на уровне покупателя, а затем уже агрегируем до уровня категории.
Если в один и тот же день один и тот же покупатель совершил несколько транзакций в одной и той же категории, то считаем, что это одно событие для расчета дискретности.
Важно понимать, что в один и тот же день один и тот же покупатель мог совершить транзакции в разных категориях. В этом случае предыдущая транзакция в категории у этого покупателя могла быть в разные даты.
Подсказка: в эталонном запросе 4 CTE, может быть и меньше, но в процессе обучения точно не стоит бояться мельчить.
Подсказка: в ClickHouse если дата не найдена, то будет автоматическая подстановка 01.01.1970.
Запрос должен вернуть 4 колонки: наименование категории, среднее количество дней между датами транзакций у покупателей, минимальное количество дней между датами транзакций у покупателей, максимальное количество дней между датами транзакций у покупателей
Ключевые слова и фразы: JOIN, LAG, AVG, MIN, MAX, PARTITION BY, UNBOUNDED PRECEDING AND CURRENT ROW (CH)