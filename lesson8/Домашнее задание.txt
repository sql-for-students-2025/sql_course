1. Найти 10 покупателей, у которых самый многообещающий тренд по сумме транзакции. Многообещающий тренд определяем, как наибольшее значение наклона прогноза следующей суммы транзакции покупателя на основе линейной регрессии его покупок.
Формулу линейной регресии определяем на основе скользящего среднего сумм транзакций покупателя за первое полугодие 2025 года с шириной окна 3, включая текущую транзакцию. У покупателя за отчетный период должно быть минимум 6 транзакций (в среднем одна транзакция в месяц).
Подсказка: По каждому покупателю считаем скользящее среднее всех транзакций. Скользящие средние, первых двух транзакций исключаем, так как у них нет достаточного числа событий.
Далее по каждому покупателю вычисляем коэффициент k модели линейной регресии на основе его транзакций. В итоге оставляем 10 покупателей с наибольшим коэффициентом k.
Запрос должен вернуть две колонки: идентификатор покупателя, значение коэффициента k.
Ключевые слова и фразы: ROW_NUMBER, AVG, LIMIT, PARTITION BY, PRECEDING, CURRENT ROW, REGR_SLOPE (PG), simpleLinearRegression (CH)

2. Вычислить среднюю, минимальную и максимальную дискретность транзакций на покупателя в разрезе категорий "Кофе" и "Сахар" за период с марта 2025 по июль 2025 включительно.
Дискретность считаем изначально на уровне покупателя, а затем уже агрегируем до уровня категории.
Если в один и тот же день один и тот же покупатель совершил несколько транзакций в одной и той же категории, то считаем, что это одно событие для расчета дискретности.
Важно понимать, что в один и тот же день один и тот же покупатель мог совершить транзакции в разных категориях. В этом случае предыдущая транзакция в категории у этого покупателя могла быть в разные даты.
Подсказка: в эталонном запросе 4 CTE, может быть и меньше, но в процессе обучения точно не стоит бояться мельчить.
Подсказка: в ClickHouse если дата не найдена, то будет автоматическая подстановка 01.01.1970.
Запрос должен вернуть 4 колонки: наименование категории, среднее количество дней между датами транзакций у покупателей, минимальное количество дней между датами транзакций у покупателей, максимальное количество дней между датами транзакций у покупателей
Ключевые слова и фразы: JOIN, LAG, AVG, MIN, MAX, PARTITION BY, UNBOUNDED PRECEDING AND CURRENT ROW (CH)

3. Вычислить общую сумму транзакций, в которых был хотя бы один товар из категории "Сахар", за все время в разрезе четных-нечетных (по дате совершения) транзакций. Признак четной-нечетной транзакции определяем для каждого покупателя отдельно.
Подсказка: функция для нахождения остатка от деления - mod.
Подсказка: в Clickhouse дополнительно к сортировке внутри оконной рамки необходимо добавить сортировку по количеству, иначе СУБД по одному и тому же коду возвращает разный результат при каждом очередном перезапуске.
Запрос должен вернуть 2 колонки: признак четная-нечетная (0 - четная, 1 - нечетная) транзакция и количество единиц товара.
Ключевые слова и фразы: ROW_NUMBER, PARTITION BY

4. Найти топ-10 покупателей у которых наибольшая доля суммы одной транзакции по отношению ко всем их транзакциям за все время. Другими словами наибольший вклад одной транзакции покупателя в выручку по нему.
При этом у рассматриваемых покупателей за все время должно быть не менее 6 транзакций. Результат необходимо дополнительно отсортировать по возрастанию идентификатора покупателя.
Подсказка: ClickHouse не делает автоматического перевода типа данных numeric во float при вычислении доли, требуется явное преобразование.
Запрос должен вернуть 2 колонки: идентификатор покупателя и долю суммы одной какой-то его транзакции к сумме всех транзакций этого покупателя.
Ключевые слова и фразы: COUNT, SUM, PARTITION BY, ORDER, LIMIT

5. Посчитать количество уникальных покупателей у которых их возраст полных лет от текущей даты больше, чем средний возраст по базе для их имени, увеличенный на стандартное отклонение по возрасту для их имени.
Другими словами нас интересуют покупатели, у которых возраст в настоящий момент больше (средний возраст по их имени + стандартное отклонение возраста для их имени).
Подсказка: функции для нахождения стандартного отклонения stddev (PG) и stddevSamp (CH), она тоже является оконной.
Запрос должен вернуть одно значение: количество покупателей.
Ключевые слова и фразы: AVG, STDDEV, PARTITION BY